/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/virtual-scroll.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostListener, Input, ElementRef, Output, EventEmitter, Renderer2 } from '@angular/core';
export class VirtualScrollDirective {
    /**
     * @param {?} el
     * @param {?} renderer
     */
    constructor(el, renderer) {
        this.el = el;
        this.renderer = renderer;
        this.scrollOffset = 0;
        this.itemHeight = 40;
        this.rangeChanged = new EventEmitter();
        this.lastScrollFireTime = 0;
    }
    /**
     * @param {?} count
     * @return {?}
     */
    set totalCount(count) {
        this._totalCount = count;
        count ? this.initialSetup() : this.reset();
    }
    /**
     * @return {?}
     */
    get() {
        return this._totalCount;
    }
    /**
     * @return {?}
     */
    reset() {
        if (this.top && this.bottom) {
            this.renderer.setStyle(this.top, 'height', 0);
            this.renderer.setStyle(this.bottom, 'height', 0);
            this.renderer.setProperty(this.el.nativeElement, 'scrollTop', 0);
        }
    }
    /**
     * @param {?} target
     * @return {?}
     */
    throttleScroll(target) {
        const { scrollTop, clientHeight } = target;
        /** @type {?} */
        const totalHeight = this.itemHeight * this._totalCount + this.scrollOffset;
        // Step: 1 - Calculate the position
        /** @type {?} */
        const topSpacing = scrollTop;
        /** @type {?} */
        const maxItemsRange = (clientHeight - this.scrollOffset) / this.itemHeight;
        // Step: 2 - What are the possible collection that can be rendered
        /** @type {?} */
        const rangeOffset = topSpacing % this.itemHeight;
        /** @type {?} */
        const rangeStart = topSpacing - rangeOffset;
        /** @type {?} */
        const topNonVisible = topSpacing / this.itemHeight;
        /** @type {?} */
        const itemStartRange = Math.floor(topNonVisible);
        /** @type {?} */
        const rangeToBeIncreamented = rangeOffset ? maxItemsRange + 1 : maxItemsRange;
        /** @type {?} */
        const calculatedEndRange = itemStartRange + rangeToBeIncreamented;
        /** @type {?} */
        const itemEndRange = calculatedEndRange >= this._totalCount ? this._totalCount : calculatedEndRange;
        /** @type {?} */
        const bottomSpacing = totalHeight - (rangeStart + rangeToBeIncreamented * this.itemHeight);
        // Step: 3 - Pass the range to the child directive
        this.renderer.setStyle(this.top, 'height', `${rangeStart}px`);
        this.renderer.setStyle(this.bottom, 'height', `${bottomSpacing}px`);
        this.rangeChanged.emit({ start: itemStartRange, end: itemEndRange });
    }
    /**
     * @param {?} __0
     * @return {?}
     */
    onscroll({ target }) {
        /** @type {?} */
        const minScrollTime = 50;
        /** @type {?} */
        const now = new Date().getTime();
        if (!this.scrollTimer) {
            if (now - this.lastScrollFireTime > minScrollTime) {
                this.lastScrollFireTime = now;
            }
            this.scrollTimer = setTimeout((/**
             * @return {?}
             */
            () => {
                this.scrollTimer = null;
                this.lastScrollFireTime = new Date().getTime();
                this.throttleScroll(target);
            }), minScrollTime);
        }
    }
    /**
     * @return {?}
     */
    initialSetup() {
        // TODO: later think of usng ViewChild, instead of direct DOM manipulation.
        const { scrollTop, clientHeight } = this.el.nativeElement;
        this.top = this.renderer.selectRootElement('.top');
        this.bottom = this.renderer.selectRootElement('.bottom');
        this.renderer.setStyle(this.top, 'height', `${scrollTop}px`);
        this.renderer.setStyle(this.bottom, 'height', `${this.itemHeight * this._totalCount + this.scrollOffset - clientHeight}px`);
        this.renderer.setProperty(this.el.nativeElement, 'scrollTop', 0);
    }
}
VirtualScrollDirective.decorators = [
    { type: Directive, args: [{
                selector: '[msVirtualScroll]'
            },] }
];
/** @nocollapse */
VirtualScrollDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
VirtualScrollDirective.propDecorators = {
    itemHeight: [{ type: Input }],
    totalCount: [{ type: Input }],
    rangeChanged: [{ type: Output }],
    onscroll: [{ type: HostListener, args: ['scroll', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    VirtualScrollDirective.prototype._totalCount;
    /** @type {?} */
    VirtualScrollDirective.prototype.top;
    /** @type {?} */
    VirtualScrollDirective.prototype.bottom;
    /** @type {?} */
    VirtualScrollDirective.prototype.scrollOffset;
    /** @type {?} */
    VirtualScrollDirective.prototype.itemHeight;
    /** @type {?} */
    VirtualScrollDirective.prototype.rangeChanged;
    /**
     * @type {?}
     * @private
     */
    VirtualScrollDirective.prototype.scrollTimer;
    /**
     * @type {?}
     * @private
     */
    VirtualScrollDirective.prototype.lastScrollFireTime;
    /**
     * @type {?}
     * @private
     */
    VirtualScrollDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    VirtualScrollDirective.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlydHVhbC1zY3JvbGwuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9wYW5rYWpwYXJrYXIvRG9jdW1lbnRzL0dpdEh1Yi9tdWx0aXNlbGVjdC9wcm9qZWN0cy9tdWx0aXNlbGVjdC9zcmMvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy92aXJ0dWFsLXNjcm9sbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSzVHLE1BQU0sT0FBTyxzQkFBc0I7Ozs7O0lBZ0JqQyxZQUFvQixFQUFjLEVBQVUsUUFBbUI7UUFBM0MsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFaL0QsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFDUixlQUFVLEdBQVcsRUFBRSxDQUFDO1FBUXZCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUV6Qyx1QkFBa0IsR0FBRyxDQUFDLENBQUM7SUFDbUMsQ0FBQzs7Ozs7SUFWbkUsSUFBYSxVQUFVLENBQUMsS0FBSztRQUMzQixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUN6QixLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdDLENBQUM7Ozs7SUFDRCxHQUFHO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7Ozs7SUFNRCxLQUFLO1FBQ0gsSUFBSSxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxRQUFR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O1FBQ25ELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxHQUFHLFNBQVMsSUFBSSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFhLElBQUksQ0FBQyxDQUFDO1FBQzdILElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNuRSxDQUFDOzs7WUE5RUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxtQkFBbUI7YUFDOUI7Ozs7WUFKd0MsVUFBVTtZQUF3QixTQUFTOzs7eUJBVWpGLEtBQUs7eUJBQ0wsS0FBSzsyQkFPTCxNQUFNO3VCQXFDTixZQUFZLFNBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDOzs7Ozs7O0lBakRsQyw2Q0FBNEI7O0lBQzVCLHFDQUFpQjs7SUFDakIsd0NBQW9COztJQUNwQiw4Q0FBaUI7O0lBQ2pCLDRDQUFpQzs7SUFRakMsOENBQWlEOzs7OztJQUNqRCw2Q0FBb0I7Ozs7O0lBQ3BCLG9EQUErQjs7Ozs7SUFDbkIsb0NBQXNCOzs7OztJQUFFLDBDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSG9zdExpc3RlbmVyLCBJbnB1dCwgRWxlbWVudFJlZiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbXNWaXJ0dWFsU2Nyb2xsXSdcbn0pXG5leHBvcnQgY2xhc3MgVmlydHVhbFNjcm9sbERpcmVjdGl2ZSB7XG4gIHByaXZhdGUgX3RvdGFsQ291bnQ6IG51bWJlcjtcbiAgdG9wOiBIVE1MRWxlbWVudDtcbiAgYm90dG9tOiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsT2Zmc2V0ID0gMDtcbiAgQElucHV0KCkgaXRlbUhlaWdodDogbnVtYmVyID0gNDA7XG4gIEBJbnB1dCgpIHNldCB0b3RhbENvdW50KGNvdW50KSB7XG4gICAgdGhpcy5fdG90YWxDb3VudCA9IGNvdW50O1xuICAgIGNvdW50ID8gdGhpcy5pbml0aWFsU2V0dXAoKSA6IHRoaXMucmVzZXQoKTtcbiAgfVxuICBnZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RvdGFsQ291bnQ7XG4gIH1cbiAgQE91dHB1dCgpIHJhbmdlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBwcml2YXRlIHNjcm9sbFRpbWVyO1xuICBwcml2YXRlIGxhc3RTY3JvbGxGaXJlVGltZSA9IDA7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge31cblxuICByZXNldCgpIHtcbiAgICBpZiAodGhpcy50b3AgJiYgdGhpcy5ib3R0b20pIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b3AsICdoZWlnaHQnLCAwKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5ib3R0b20sICdoZWlnaHQnLCAwKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnc2Nyb2xsVG9wJywgMCk7XG4gICAgfVxuICB9XG5cbiAgdGhyb3R0bGVTY3JvbGwodGFyZ2V0KSB7XG4gICAgY29uc3QgeyBzY3JvbGxUb3AsIGNsaWVudEhlaWdodCB9ID0gdGFyZ2V0O1xuICAgIGNvbnN0IHRvdGFsSGVpZ2h0ID0gdGhpcy5pdGVtSGVpZ2h0ICogdGhpcy5fdG90YWxDb3VudCArIHRoaXMuc2Nyb2xsT2Zmc2V0O1xuXG4gICAgLy8gU3RlcDogMSAtIENhbGN1bGF0ZSB0aGUgcG9zaXRpb25cbiAgICBjb25zdCB0b3BTcGFjaW5nID0gc2Nyb2xsVG9wO1xuICAgIGNvbnN0IG1heEl0ZW1zUmFuZ2UgPSAoY2xpZW50SGVpZ2h0IC0gdGhpcy5zY3JvbGxPZmZzZXQpIC8gdGhpcy5pdGVtSGVpZ2h0O1xuXG4gICAgLy8gU3RlcDogMiAtIFdoYXQgYXJlIHRoZSBwb3NzaWJsZSBjb2xsZWN0aW9uIHRoYXQgY2FuIGJlIHJlbmRlcmVkXG4gICAgY29uc3QgcmFuZ2VPZmZzZXQgPSB0b3BTcGFjaW5nICUgdGhpcy5pdGVtSGVpZ2h0O1xuICAgIGNvbnN0IHJhbmdlU3RhcnQgPSB0b3BTcGFjaW5nIC0gcmFuZ2VPZmZzZXQ7XG4gICAgY29uc3QgdG9wTm9uVmlzaWJsZSA9IHRvcFNwYWNpbmcgLyB0aGlzLml0ZW1IZWlnaHQ7XG4gICAgY29uc3QgaXRlbVN0YXJ0UmFuZ2UgPSBNYXRoLmZsb29yKHRvcE5vblZpc2libGUpO1xuICAgIGNvbnN0IHJhbmdlVG9CZUluY3JlYW1lbnRlZCA9IHJhbmdlT2Zmc2V0ID8gbWF4SXRlbXNSYW5nZSArIDEgOiBtYXhJdGVtc1JhbmdlO1xuICAgIGNvbnN0IGNhbGN1bGF0ZWRFbmRSYW5nZSA9IGl0ZW1TdGFydFJhbmdlICsgcmFuZ2VUb0JlSW5jcmVhbWVudGVkO1xuICAgIGNvbnN0IGl0ZW1FbmRSYW5nZSA9IGNhbGN1bGF0ZWRFbmRSYW5nZSA+PSB0aGlzLl90b3RhbENvdW50ID8gdGhpcy5fdG90YWxDb3VudCA6IGNhbGN1bGF0ZWRFbmRSYW5nZTtcbiAgICBjb25zdCBib3R0b21TcGFjaW5nID0gdG90YWxIZWlnaHQgLSAocmFuZ2VTdGFydCArIHJhbmdlVG9CZUluY3JlYW1lbnRlZCAqIHRoaXMuaXRlbUhlaWdodCk7XG5cbiAgICAvLyBTdGVwOiAzIC0gUGFzcyB0aGUgcmFuZ2UgdG8gdGhlIGNoaWxkIGRpcmVjdGl2ZVxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b3AsICdoZWlnaHQnLCBgJHtyYW5nZVN0YXJ0fXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmJvdHRvbSwgJ2hlaWdodCcsIGAke2JvdHRvbVNwYWNpbmd9cHhgKTtcbiAgICB0aGlzLnJhbmdlQ2hhbmdlZC5lbWl0KHsgc3RhcnQ6IGl0ZW1TdGFydFJhbmdlLCBlbmQ6IGl0ZW1FbmRSYW5nZSB9KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3Njcm9sbCcsIFsnJGV2ZW50J10pXG4gIG9uc2Nyb2xsKHsgdGFyZ2V0IH0pIHtcbiAgICBjb25zdCBtaW5TY3JvbGxUaW1lID0gNTA7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgaWYgKCF0aGlzLnNjcm9sbFRpbWVyKSB7XG4gICAgICBpZiAobm93IC0gdGhpcy5sYXN0U2Nyb2xsRmlyZVRpbWUgPiBtaW5TY3JvbGxUaW1lKSB7XG4gICAgICAgIHRoaXMubGFzdFNjcm9sbEZpcmVUaW1lID0gbm93O1xuICAgICAgfVxuICAgICAgdGhpcy5zY3JvbGxUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnNjcm9sbFRpbWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0U2Nyb2xsRmlyZVRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgdGhpcy50aHJvdHRsZVNjcm9sbCh0YXJnZXQpO1xuICAgICAgfSwgbWluU2Nyb2xsVGltZSk7XG4gICAgfVxuICB9XG5cbiAgaW5pdGlhbFNldHVwKCkge1xuICAgIC8vIFRPRE86IGxhdGVyIHRoaW5rIG9mIHVzbmcgVmlld0NoaWxkLCBpbnN0ZWFkIG9mIGRpcmVjdCBET00gbWFuaXB1bGF0aW9uLlxuICAgIGNvbnN0IHsgc2Nyb2xsVG9wLCBjbGllbnRIZWlnaHQgfSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICBcbiAgICB0aGlzLnRvcCA9IHRoaXMucmVuZGVyZXIuc2VsZWN0Um9vdEVsZW1lbnQoJy50b3AnKTtcbiAgICB0aGlzLmJvdHRvbSA9IHRoaXMucmVuZGVyZXIuc2VsZWN0Um9vdEVsZW1lbnQoJy5ib3R0b20nKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudG9wLCAnaGVpZ2h0JywgYCR7c2Nyb2xsVG9wfXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmJvdHRvbSwgJ2hlaWdodCcsIGAke3RoaXMuaXRlbUhlaWdodCAqIHRoaXMuX3RvdGFsQ291bnQgKyB0aGlzLnNjcm9sbE9mZnNldCAtIGNsaWVudEhlaWdodCB9cHhgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3Njcm9sbFRvcCcsIDApO1xuICB9XG59XG4iXX0=